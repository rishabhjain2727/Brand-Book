<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>LPU Brand Book – With Multi-Audience Cohorts</title>
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
  />
  <style>
    :root {
      --primary: #f37021;
      --secondary: #c65010;
      --accent: #4361ee;
      --light: #f8f9fa;
      --dark: #212529;
      --success: #4caf50;
      --warning: #f72585;
      --gray: #6c757d;
      --light-gray: #e9ecef;
      --border-radius: 8px;
      --shadow: 0 6px 18px rgba(0,0,0,0.06);
      --transition: all 0.28s ease;
    }

    * { box-sizing: border-box; margin:0; padding:0; font-family:"Segoe UI", Tahoma, Geneva, Verdana, sans-serif; }
    html, body { height:100%; background:#f5f7fb; color:var(--dark); }
    .container { display:flex; height:100vh; }

    /* Sidebar */
    .sidebar {
      width:320px; background:white; box-shadow:var(--shadow); padding:20px; overflow-y:auto; flex-shrink:0;
    }
    .logo { display:flex; align-items:center; margin-bottom:12px; padding-bottom:12px; border-bottom:1px solid var(--light-gray); }
    .logo i { font-size:24px; color:var(--primary); margin-right:10px; }
    .logo h1 { font-size:20px; font-weight:700; }

    .small-note { font-size:12px; color:var(--gray); margin-bottom:15px; }
    .pillar-list { list-style:none; padding-left:0; }
    .pillar-item { margin-bottom:6px; }
    .pillar-header { display:flex; align-items:center; justify-content:space-between; padding:10px 12px; background-color:var(--light); border-radius:var(--border-radius); cursor:pointer; transition:var(--transition); font-weight:600; font-size:14px; }
    .pillar-header:hover { background-color:var(--light-gray); }
    .pillar-header.active { background-color:var(--primary); color:white; }
    .pillar-header i { font-size:14px; transition:var(--transition); }
    .pillar-header.active i { transform:rotate(90deg); }

    .sub-pillars { list-style:none; max-height:0; overflow:hidden; transition:var(--transition); padding-left:10px; }
    .sub-pillars.show { max-height:900px; }

    .sub-pillar { margin:6px 0; padding:8px 12px; border-left:2px solid var(--light-gray); cursor:pointer; transition:var(--transition); font-size:13px; display:flex; flex-direction:column; gap:6px; border-radius:6px; background:transparent; }
    .sub-pillar:hover { border-left-color:var(--accent); background:rgba(72,149,239,0.03); }
    .sub-pillar.active { border-left-color:var(--primary); background:rgba(243,112,33,0.06); font-weight:600; }
    .sub-pillar-main { display:flex; align-items:center; justify-content:space-between; gap:8px; }
    .sub-pillar-left { display:flex; align-items:center; gap:8px; }
    .sub-pillar-summary { font-size:12px; color:var(--gray); padding-left:18px; }

    .status-dot { width:8px; height:8px; border-radius:50%; background:var(--light-gray); }
    .sub-pillar.completed .status-dot { background:var(--success); }

    /* Main content */
    .main-content { flex:1; padding:20px 28px; overflow-y:auto; }
    .content-header { display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:16px; padding-bottom:14px; border-bottom:1px solid var(--light-gray); }
    .content-header h2 { font-size:22px; color:var(--dark); }
    .content-sub { font-size:13px; color:var(--gray); }

    .progress-container { display:flex; flex-direction:column; align-items:flex-end; gap:4px; padding:10px 14px; background:linear-gradient(135deg,#f37021,#f9a826); border-radius:10px; color:white; box-shadow:var(--shadow); min-width:260px; }
    .progress-title { font-size:12px; text-transform:uppercase; opacity:0.9; letter-spacing:0.06em; }
    .progress-main-num { font-size:26px; font-weight:700; line-height:1.1; }
    .progress-bar { width:280px; height:14px; background-color:rgba(255,255,255,0.25); border-radius:14px; overflow:hidden; }
    .progress { height:100%; background:linear-gradient(90deg,#ffffff,#d2f5dd); width:0%; border-radius:14px; transition:var(--transition); }
    .progress-text { font-size:12px; font-weight:500; }

    .form-container { background:white; border-radius:var(--border-radius); box-shadow:var(--shadow); padding:20px 22px; margin-bottom:18px; animation:fadeIn 0.3s ease; }
    .form-header h3 { font-size:18px; color:var(--primary); margin-bottom:4px; }
    .form-header p { font-size:13px; color:var(--gray); margin-bottom:14px; }

    .form-group { margin-bottom:14px; }
    .form-group label { display:block; margin-bottom:6px; font-weight:600; color:var(--dark); font-size:14px; }
    .form-group .hint { font-size:12px; color:var(--gray); margin-top:4px; }

    input, textarea, select { width:100%; padding:9px 11px; border:1px solid var(--light-gray); border-radius:var(--border-radius); font-size:14px; transition:var(--transition); }
    textarea { min-height:110px; resize:vertical; }
    input:focus, textarea:focus, select:focus { outline:none; border-color:var(--accent); box-shadow:0 0 0 2px rgba(72,149,239,0.12); }

    .file-upload { border:2px dashed var(--light-gray); border-radius:var(--border-radius); padding:18px; text-align:center; cursor:pointer; transition:var(--transition); font-size:13px; color:var(--gray); }
    .file-upload i { font-size:24px; margin-bottom:6px; color:var(--gray); }
    .file-upload:hover { border-color:var(--accent); background-color:rgba(72,149,239,0.05); }

    .swot-grid { display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:10px; }
    .swot-box { border-radius:var(--border-radius); border:1px solid var(--light-gray); padding:10px; background:var(--light); }
    .swot-box h4 { font-size:13px; margin-bottom:6px; }

    .form-actions { display:flex; justify-content:flex-end; gap:10px; margin-top:10px; }
    .btn { padding:9px 16px; border-radius:var(--border-radius); border:none; font-size:14px; cursor:pointer; font-weight:600; display:inline-flex; align-items:center; gap:6px; transition:var(--transition); }
    .btn-primary { background:var(--primary); color:white; }
    .btn-primary:hover { background:var(--secondary); }
    .btn-outline { border:1px solid var(--primary); color:var(--primary); background:transparent; }
    .btn-outline:hover { background:rgba(243,112,33,0.08); }

    .empty-state { text-align:center; color:var(--gray); padding:60px 20px; }
    .empty-state i { font-size:48px; margin-bottom:12px; color:var(--light-gray); }

    /* chips */
    .chip-row { display:flex; flex-wrap:wrap; gap:8px; margin-bottom:8px; }
    .chip-toggle { padding:6px 12px; border-radius:999px; border:1px solid var(--light-gray); background:#fff; font-size:13px; cursor:pointer; transition:var(--transition); }
    .chip-toggle.active { background:var(--primary); color:#fff; border-color:var(--primary); }
    .radio-row { display:flex; gap:16px; font-size:13px; margin-bottom:8px; }
    .selected-tags { min-height:40px; padding:8px; border-radius:var(--border-radius); border:1px dashed var(--light-gray); font-size:13px; display:flex; flex-wrap:wrap; gap:6px; }
    .tag-pill { padding:4px 10px; background:var(--light); border-radius:999px; font-size:12px; cursor:pointer; }

    /* Audience-specific UI */
    .audience-action-row { display:flex; justify-content:flex-end; margin-bottom:10px; }
    .audience-add-btn { color:var(--accent); cursor:pointer; font-weight:600; text-decoration:none; display:inline-flex; gap:8px; align-items:center; }
    .audience-block { border:1px solid var(--light-gray); border-radius:10px; padding:14px; margin-bottom:12px; background:#fff; position:relative; }
    .audience-header { display:flex; justify-content:space-between; align-items:center; gap:12px; margin-bottom:10px; }
    .audience-header h4 { margin:0; font-size:15px; }
    .audience-controls { display:flex; gap:10px; align-items:center; }
    .audience-remove { background:transparent; border:1px solid #f1a59d; color:#d6452a; padding:6px 10px; border-radius:8px; cursor:pointer; }
    .audience-name-input input { width:260px; padding:8px 10px; }
    .audience-error-note { color:#e55353; font-size:12px; margin-top:6px; display:none; }

    .audience-section-label { font-size:13px; font-weight:600; margin:12px 0 8px; display:block; }
    .location-row { display:flex; gap:18px; align-items:center; margin-bottom:8px; }
    .location-input { margin-top:10px; }
    .loc-type-box { border:1px dashed var(--light-gray); padding:12px; border-radius:8px; margin-top:8px; }
    .detailed-targeting-input input { padding-left:34px; }
    .detailed-targeting-input i { position:absolute; left:10px; top:50%; transform:translateY(-50%); color:var(--gray); }

    .audience-footer { display:flex; justify-content:space-between; align-items:center; gap:12px; margin-top:12px; }
    .btn-outline { border:1px solid var(--primary); color:var(--primary); background:transparent; }
    .btn-primary { background:var(--primary); color:#fff; }

    @media (max-width:992px) {
      .container { flex-direction:column; }
      .sidebar { width:100%; max-height:40vh; }
      .swot-grid { grid-template-columns:1fr; }
    }

    @keyframes fadeIn { from { opacity:0; transform:translateY(6px);} to { opacity:1; transform:translateY(0);} }
  </style>
</head>
<body>
  <div class="container">
    <!-- SIDEBAR -->
    <div class="sidebar">
      <div class="logo">
        <i class="fas fa-graduation-cap"></i>
        <h1>LPU Brand Book</h1>
      </div>
      <p class="small-note">
        All pillars & sub-pillars are present and marked as completed for this
        LPU brand book.
      </p>
      <ul class="pillar-list" id="pillarList"></ul>
    </div>

    <!-- MAIN -->
    <div class="main-content">
      <div class="content-header">
        <div>
          <h2 id="sectionTitle">Brand History</h2>
          <p id="sectionSubtitle" class="content-sub">Brand Overview</p>
        </div>
        <div class="progress-container">
          <div class="progress-title">Brand Book Completion</div>
          <div class="progress-main-num" id="progressPercent">0%</div>
          <div class="progress-bar">
            <div class="progress" id="progressBar"></div>
          </div>
          <span class="progress-text" id="progressText"></span>
        </div>
      </div>

      <div id="formRoot"></div>
    </div>
  </div>

  <script>
    // -------- CONFIG FOR LPU BRAND --------
    // type: 'short', 'long', 'upload', 'swot', 'color', 'table', 'cohort'
    const BRAND_STRUCTURE = [
      {
        id: "brand-overview",
        label: "Brand Overview",
        sections: [
          { id: "brand-history", label: "Brand History", type: "long", hint: "Capture how LPU started and evolved over time.", content: `Lovely Professional University (LPU) began...` },
          { id: "brand-purpose", label: "Brand Purpose", type: "long", hint: "Why does the LPU brand exist beyond profit?", content: `LPU exists to transform education...` },
          { id: "company-snapshot", label: "Company Snapshot", type: "long", hint: "Quick facts and current status of LPU.", content: `• Type: Private state university...` }
        ]
      },
      // ... (rest of structure is same as before, for brevity include essential blocks)
      {
        id: "target-audience",
        label: "Target Audience",
        sections: [
          { id: "demographics", label: "Demographics (Cohorts)", type: "cohort", hint: "Age, gender, income and basic profile cohorts for LPU." },
          { id: "psychographics", label: "Psychographics", type: "long", hint: "Mindset, motivations and attitudes of LPU students." },
          { id: "pain-points", label: "Pain Points", type: "long", hint: "Key challenges and concerns of prospects and parents." },
          { id: "buyer-journey-map", label: "Buyer Journey Map", type: "long", hint: "End-to-end journey from awareness to onboarding." }
        ]
      },
      {
        id: "competitive-landscape",
        label: "Competitive Landscape",
        sections: [
          { id: "market-position-map", label: "Market Position Map", type: "upload", hint: "Visual map of LPU vs competitors on key axes." },
          { id: "swot-analysis", label: "SWOT Analysis", type: "swot", hint: "Strengths, weaknesses, opportunities, threats for LPU." },
          { id: "industry-benchmarks", label: "Industry Benchmarks", type: "table", hint: "Metrics to compare LPU with peer institutions." }
        ]
      }
      // (You can add more pillars/sections as in your original file)
    ];

    // ---------- STATE ----------
    const completionState = {};
    BRAND_STRUCTURE.forEach(p => p.sections.forEach(sec => { completionState[sec.id] = true; }));
    const totalSections = BRAND_STRUCTURE.reduce((sum, p) => sum + p.sections.length, 0);

    // ---------- DOM REFS ----------
    const pillarListEl = document.getElementById("pillarList");
    const formRoot = document.getElementById("formRoot");
    const sectionTitleEl = document.getElementById("sectionTitle");
    const sectionSubtitleEl = document.getElementById("sectionSubtitle");
    const progressBarEl = document.getElementById("progressBar");
    const progressTextEl = document.getElementById("progressText");
    const progressPercentEl = document.getElementById("progressPercent");

    // ---------- SIDEBAR RENDER ----------
    function renderSidebar() {
      pillarListEl.innerHTML = "";
      BRAND_STRUCTURE.forEach((pillar, idx) => {
        const li = document.createElement("li"); li.className = "pillar-item";
        const header = document.createElement("div");
        header.className = "pillar-header" + (idx === 0 ? " active" : "");
        header.dataset.pillarId = pillar.id;
        header.innerHTML = `<span>${pillar.label}</span><i class="fas fa-chevron-right"></i>`;
        const subList = document.createElement("ul");
        subList.className = "sub-pillars" + (idx === 0 ? " show" : "");
        pillar.sections.forEach((sec, sIdx) => {
          const subLi = document.createElement("li");
          subLi.className = "sub-pillar" + (idx === 0 && sIdx === 0 ? " active completed" : " completed");
          subLi.dataset.sectionId = sec.id;
          const summaryText = sec.hint || "Click to edit details for this section.";
          subLi.innerHTML = `
            <div class="sub-pillar-main">
              <div class="sub-pillar-left">
                <i class="fas fa-circle-notch"></i>
                <span>${sec.label}</span>
              </div>
              <span class="status-dot"></span>
            </div>
            <div class="sub-pillar-summary">${summaryText}</div>
          `;
          subList.appendChild(subLi);
        });
        li.appendChild(header); li.appendChild(subList); pillarListEl.appendChild(li);
      });

      document.querySelectorAll(".sub-pillar.completed .status-dot").forEach(dot => dot.style.background = "var(--success)");
      bindSidebarEvents();
    }

    function bindSidebarEvents() {
      document.querySelectorAll(".pillar-header").forEach((header) => {
        header.addEventListener("click", () => {
          document.querySelectorAll(".pillar-header").forEach((h) => {
            if (h !== header) { h.classList.remove("active"); h.nextElementSibling.classList.remove("show"); }
          });
          header.classList.toggle("active");
          header.nextElementSibling.classList.toggle("show");
        });
      });

      document.querySelectorAll(".sub-pillar").forEach((sub) => {
        sub.addEventListener("click", () => {
          const sectionId = sub.dataset.sectionId;
          document.querySelectorAll(".sub-pillar").forEach((s) => s.classList.remove("active"));
          sub.classList.add("active");
          const section = findSectionById(sectionId);
          if (section) renderSectionForm(section);
        });
      });
    }

    function findSectionById(id) {
      for (const pillar of BRAND_STRUCTURE) {
        for (const sec of pillar.sections) {
          if (sec.id === id) return { pillar, sec };
        }
      }
      return null;
    }

    // ---------- RENDER SECTION FORM ----------
    function renderSectionForm({ pillar, sec }) {
      sectionTitleEl.textContent = sec.label;
      sectionSubtitleEl.textContent = pillar.label;

      const container = document.createElement("div");
      container.className = "form-container";

      const header = document.createElement("div");
      header.className = "form-header";
      header.innerHTML = `<h3>${sec.label}</h3><p>${sec.hint || "Edit the pre-filled LPU content for this section if needed."}</p>`;
      container.appendChild(header);

      const formBody = document.createElement("div");

      switch (sec.type) {
        case "short": formBody.appendChild(makeShortField(sec)); break;
        case "upload": formBody.appendChild(makeUploadField()); break;
        case "table": formBody.appendChild(makeTableField(sec)); break;
        case "swot": formBody.appendChild(makeSwotField()); break;
        case "color": formBody.appendChild(makeColorField()); break;
        case "cohort": formBody.appendChild(makeCohortField()); break;
        case "long":
        default: formBody.appendChild(makeLongField(sec)); break;
      }

      container.appendChild(formBody);

      const actions = document.createElement("div");
      actions.className = "form-actions";
      actions.innerHTML = `
        <button class="btn btn-outline" type="button"><i class="fas fa-rotate-left"></i> Reset</button>
        <button class="btn btn-primary" type="button">Save Section <i class="fas fa-check"></i></button>
      `;
      const [resetBtn, saveBtn] = actions.querySelectorAll("button");

      resetBtn.addEventListener("click", () => {
        container.querySelectorAll("input, textarea").forEach((el) => {
          if (el.type === "color") return;
          if (el.type === "radio") return;
          el.value = "";
        });
        container.querySelectorAll(".chip-toggle").forEach((c) => c.classList.remove("active"));
      });

      saveBtn.addEventListener("click", () => {
        completionState[sec.id] = true;
        updateCompletionUI();
        markSidebarCompleted(sec.id);
      });

      container.appendChild(actions);
      formRoot.innerHTML = "";
      formRoot.appendChild(container);

      // attach global click handling for chip-toggle behavior in any section
      container.addEventListener("click", (e) => {
        if (e.target.classList.contains("chip-toggle")) {
          e.target.classList.toggle("active");
        }
      });

      // If this is cohort, initialize the audience builder inside the container
      if (sec.type === "cohort") {
        initCohortBuilder(container);
      }
    }

    // ---------- FIELD BUILDERS ----------
    function makeShortField(sec) {
      const wrapper = document.createElement("div"); wrapper.className = "form-group";
      wrapper.innerHTML = `<label>${sec.label}</label><input type="text" value="${sec.content || ""}" />`; return wrapper;
    }

    function makeLongField(sec) {
      const wrapper = document.createElement("div"); wrapper.className = "form-group";
      const content = sec.content || "";
      wrapper.innerHTML = `<label>${sec.label}</label><textarea>${content}</textarea><div class="hint">Pre-filled for LPU – you can edit this text.</div>`;
      return wrapper;
    }

    function makeUploadField() {
      const wrapper = document.createElement("div"); wrapper.className = "form-group";
      wrapper.innerHTML = `<label>Upload Asset (Placeholder)</label><div class="file-upload"><i class="fas fa-cloud-upload-alt"></i><p>Click to simulate uploading an image/file</p></div><div class="hint">Replace with a real file input when you integrate the backend.</div>`;
      wrapper.querySelector(".file-upload").addEventListener("click", (e) => {
        e.currentTarget.innerHTML = '<i class="fas fa-check-circle"></i><p>File uploaded (demo)</p>';
        e.currentTarget.style.borderColor = "var(--accent)"; e.currentTarget.style.backgroundColor = "rgba(72,149,239,0.08)";
      });
      return wrapper;
    }

    function makeTableField(sec) {
      const wrapper = document.createElement("div"); wrapper.className = "form-group";
      wrapper.innerHTML = `<label>${sec.label}</label><div class="swot-grid"><div class="swot-box"><h4>Item 1</h4><textarea placeholder="Describe item 1"></textarea></div><div class="swot-box"><h4>Item 2</h4><textarea placeholder="Describe item 2"></textarea></div><div class="swot-box"><h4>Item 3</h4><textarea placeholder="Describe item 3"></textarea></div><div class="swot-box"><h4>Item 4</h4><textarea placeholder="Describe item 4"></textarea></div></div><div class="hint">${sec.content || ""}</div>`;
      return wrapper;
    }

    function makeSwotField() {
      const wrapper = document.createElement("div"); wrapper.className = "form-group";
      wrapper.innerHTML = `<label>SWOT Analysis</label><div class="swot-grid"><div class="swot-box"><h4>Strengths</h4><textarea placeholder="Internal positive attributes of LPU"></textarea></div><div class="swot-box"><h4>Weaknesses</h4><textarea placeholder="Internal challenges or gaps"></textarea></div><div class="swot-box"><h4>Opportunities</h4><textarea placeholder="External trends or opportunities"></textarea></div><div class="swot-box"><h4>Threats</h4><textarea placeholder="External risks or competition"></textarea></div></div>`;
      return wrapper;
    }

    function makeColorField() {
      const wrapper = document.createElement("div"); wrapper.className = "form-group";
      wrapper.innerHTML = `<label>Primary / Secondary Color (Demo)</label><input type="color" value="#F37021" /><div class="hint">Approximate LPU orange – confirm exact values with official brand team.</div>`;
      return wrapper;
    }

    // ---- REPLACED COHORT FIELD ----
    // This returns a container; the cohort builder is initialized in initCohortBuilder()
    function makeCohortField() {
      const wrapper = document.createElement("div");
      wrapper.className = "form-group";
      wrapper.innerHTML = `
        <label>Demographics (Cohorts)</label>
        <div class="hint">Define age, gender, income and basic profile cohorts for LPU. Use multiple audiences if needed.</div>
        <div id="cohortRoot" style="margin-top:12px;"></div>
      `;
      return wrapper;
    }

    // ---------- COMPLETION ----------
    function updateCompletionUI() {
      const completed = Object.keys(completionState).length;
      const percent = 100; // fixed at 100% because everything is pre-completed in this demo
      progressBarEl.style.width = percent + "%";
      progressTextEl.textContent = `${percent}% Complete (${completed} / ${totalSections} sections)`;
      progressPercentEl.textContent = `${percent}%`;
    }

    function markSidebarCompleted(sectionId) {
      const node = document.querySelector(`.sub-pillar[data-section-id="${sectionId}"]`);
      if (node) node.classList.add("completed");
    }

    // ---------- INIT ----------
    renderSidebar();
    updateCompletionUI();
    // open first section (Brand History) by default
    const firstPillar = BRAND_STRUCTURE[0];
    const firstSec = firstPillar.sections[0];
    renderSectionForm({ pillar: firstPillar, sec: firstSec });

    // ---------- COHORT BUILDER IMPLEMENTATION ----------
    // initCohortBuilder(container) will render the multi-audience UI inside the given container element
    function initCohortBuilder(container) {
      const cohortRoot = container.querySelector('#cohortRoot');
      if (!cohortRoot) return;

      cohortRoot.innerHTML = ''; // clear

      // state
      let audienceCounter = 0;
      const audiences = {}; // store saved payloads if needed

      // create action row
      const actionRow = document.createElement('div');
      actionRow.className = 'audience-action-row';
      actionRow.innerHTML = `<a class="audience-add-btn"><i class="fas fa-plus-circle"></i> Add more audience</a>`;
      cohortRoot.appendChild(actionRow);

      const blocksWrap = document.createElement('div');
      blocksWrap.className = 'audience-blocks-wrap';
      cohortRoot.appendChild(blocksWrap);

      // add first audience by default
      addAudience(blocksWrap);

      actionRow.querySelector('.audience-add-btn').addEventListener('click', () => addAudience(blocksWrap));

      function addAudience(container, initialName = '') {
        audienceCounter += 1;
        const id = `aud-${audienceCounter}`;

        const block = document.createElement('div');
        block.className = 'audience-block';
        block.dataset.audienceId = id;
        block.innerHTML = `
          <div class="audience-header">
            <h4>Audience ${audienceCounter}</h4>
            <div class="audience-controls">
              <div class="audience-name-input">
                <label style="font-size:13px;font-weight:600;display:block;margin-bottom:6px;">Audience Name <span style="color:#e55353">*</span></label>
                <input type="text" class="audience-name" placeholder="Enter Audience Name" value="${initialName||''}" />
                <div class="audience-error-note">Audience name is required</div>
              </div>
              <button class="audience-remove" title="Remove audience">Remove</button>
            </div>
          </div>

          <div>
            <span class="audience-section-label">Audience Details <span style="color:#e55353">*</span></span>
            <div style="display:flex;gap:18px;flex-direction:column;">
              <div>
                <label style="font-weight:600;display:block;margin-bottom:8px;">Age</label>
                <div class="chip-row">
                  <button type="button" class="chip-toggle">18–24 Years</button>
                  <button type="button" class="chip-toggle">25–34 Years</button>
                  <button type="button" class="chip-toggle">35–44 Years</button>
                  <button type="button" class="chip-toggle">45–54 Years</button>
                  <button type="button" class="chip-toggle">55–64 Years</button>
                  <button type="button" class="chip-toggle">65+ Years</button>
                </div>
              </div>

              <div>
                <label style="font-weight:600;display:block;margin-bottom:8px;">Gender</label>
                <div class="chip-row">
                  <button type="button" class="chip-toggle">Male</button>
                  <button type="button" class="chip-toggle">Female</button>
                  <button type="button" class="chip-toggle">Others</button>
                </div>
              </div>

              <div>
                <label style="font-weight:600;display:block;margin-bottom:8px;">Parental Status</label>
                <div class="chip-row">
                  <button type="button" class="chip-toggle">Parent</button>
                  <button type="button" class="chip-toggle">Not a Parent</button>
                  <button type="button" class="chip-toggle">Unknown</button>
                </div>
              </div>

              <div>
                <label style="font-weight:600;display:block;margin-bottom:8px;">Household Income</label>
                <div class="chip-row">
                  <button type="button" class="chip-toggle">CAT-A (0–5L)</button>
                  <button type="button" class="chip-toggle">CTA-B (5–10L)</button>
                  <button type="button" class="chip-toggle">MIG (10–20L)</button>
                  <button type="button" class="chip-toggle">HIG (20L+)</button>
                </div>
              </div>
            </div>
          </div>

          <hr style="margin:12px 0;border:none;border-top:1px solid var(--light-gray);">

          <div>
            <span class="audience-section-label">Locations <span style="color:#e55353">*</span></span>
            <div class="location-row">
              <label><input type="radio" name="${id}-country" value="india" checked /> India</label>
              <label><input type="radio" name="${id}-country" value="enter" /> Enter Another Location</label>
            </div>

            <div class="location-input">
              <input type="text" class="audience-location-input" placeholder="Enter location to include or exclude" />
              <div class="hint">Add locations to define your audience for this audience.</div>
            </div>

            <div style="margin-top:12px;">
              <label class="audience-section-label">Location Type</label>
              <div class="loc-type-box">
                <label style="display:block;margin-bottom:8px;">
                  <input type="radio" name="${id}-loctype" value="presence_or_interest" checked />
                  Presence or interest: People in, regularly in, or who've shown interest in your included locations (recommended)
                </label>
                <label style="display:block;margin-top:6px;">
                  <input type="radio" name="${id}-loctype" value="presence" />
                  Presence: People in or regularly in your included locations
                </label>
              </div>
            </div>
          </div>

          <hr style="margin:12px 0;border:none;border-top:1px solid var(--light-gray);">

          <div>
            <label style="font-weight:600;display:block;margin-bottom:8px;">Interest</label>
            <input type="text" class="audience-interest-input" placeholder="e.g., Luxury Car" />
            <div class="hint">Type an interest and press Enter to add to Selected Interests.</div>

            <div style="margin-top:12px;">
              <label style="font-weight:600;display:block;margin-bottom:8px;">Selected Interests</label>
              <div class="selected-tags" aria-live="polite"></div>
            </div>
          </div>

          <div class="audience-footer">
            <div class="small-muted">Tip: press Enter to add interest tags</div>
            <div style="display:flex;gap:8px;">
              <button class="btn btn-outline audience-reset">Reset</button>
              <button class="btn btn-primary audience-save">Save Audience</button>
            </div>
          </div>
        `;

        // behavior
        block.querySelector('.audience-remove').addEventListener('click', () => {
          delete audiences[id];
          block.remove();
          updateAudienceIndices();
        });

        // chip toggles (delegated)
        block.addEventListener('click', (e) => {
          if (e.target.classList.contains('chip-toggle')) e.target.classList.toggle('active');
        });

        // interest -> tag
        const interestInput = block.querySelector('.audience-interest-input');
        const tagsWrap = block.querySelector('.selected-tags');
        interestInput.addEventListener('keydown', (ev) => {
          if (ev.key === 'Enter') {
            ev.preventDefault();
            const v = interestInput.value.trim();
            if (v) { addTag(v, tagsWrap); interestInput.value = ''; }
          }
        });

        function addTag(text, container) {
          const pill = document.createElement('span');
          pill.className = 'tag-pill'; pill.textContent = text;
          pill.addEventListener('click', () => pill.remove());
          container.appendChild(pill);
        }

        // reset
        block.querySelector('.audience-reset').addEventListener('click', () => {
          block.querySelectorAll('input[type="text"]').forEach(i => i.value = '');
          block.querySelectorAll('.chip-toggle').forEach(c => c.classList.remove('active'));
          block.querySelector('.selected-tags').innerHTML = '';
          block.querySelector('.audience-error-note').style.display = 'none';
        });

        // save
        block.querySelector('.audience-save').addEventListener('click', () => {
          const nameInput = block.querySelector('.audience-name');
          if (!nameInput.value.trim()) {
            block.querySelector('.audience-error-note').style.display = 'block';
            nameInput.focus(); return;
          }
          block.querySelector('.audience-error-note').style.display = 'none';
          const data = collectAudienceData(block, id);
          audiences[id] = data;
          // show quick saved state
          const saveBtn = block.querySelector('.audience-save'); const orig = saveBtn.textContent;
          saveBtn.textContent = 'Saved ✓'; setTimeout(()=> saveBtn.textContent = orig, 900);
        });

        container.appendChild(block);
        updateAudienceIndices();
        // focus input
        setTimeout(()=> { const inp = block.querySelector('.audience-name'); if (inp) inp.focus(); }, 10);
      }

      function updateAudienceIndices() {
        const blocks = document.querySelectorAll('#cohortRoot .audience-block');
        blocks.forEach((b, i) => {
          const h = b.querySelector('.audience-header h4');
          if (h) h.textContent = `Audience ${i+1}`;
        });
      }

      function collectAudienceData(block, id) {
        const name = block.querySelector('.audience-name').value.trim();
        const chipGroups = block.querySelectorAll('.chip-row');
        const agesActive = chipGroups[0] ? Array.from(chipGroups[0].querySelectorAll('.chip-toggle.active')).map(n=>n.textContent) : [];
        const genderActive = chipGroups[1] ? Array.from(chipGroups[1].querySelectorAll('.chip-toggle.active')).map(n=>n.textContent) : [];
        const parentalActive = chipGroups[2] ? Array.from(chipGroups[2].querySelectorAll('.chip-toggle.active')).map(n=>n.textContent) : [];
        const incomeActive = chipGroups[3] ? Array.from(chipGroups[3].querySelectorAll('.chip-toggle.active')).map(n=>n.textContent) : [];

        const country = block.querySelector(`input[name="${id}-country"]:checked`).value;
        const loctype = block.querySelector(`input[name="${id}-loctype"]:checked`).value;
        const locationText = block.querySelector('.audience-location-input').value.trim();
        const interests = Array.from(block.querySelectorAll('.selected-tags .tag-pill')).map(t=>t.textContent);

        return { id, name, ages: agesActive, gender: genderActive, parental: parentalActive, income: incomeActive, country, loctype, locationText, interests };
      }

      // helper exposed for debugging / saving externally
      window.getAllAudiences = function() {
        // collect from blocks (unsaved included)
        const all = [];
        document.querySelectorAll('#cohortRoot .audience-block').forEach(b => {
          const id = b.dataset.audienceId;
          all.push( collectAudienceData(b, id) );
        });
        return all;
      };

    } // end initCohortBuilder

  </script>
</body>
</html>
