<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Brand Book Creator — Segmented Donut Progress</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <style>
    :root {
      --primary: #f37c21;
      --accent: #4361ee;
      --bg: #f5f7fb;
      --card: #fff;
      --gray: #6c757d;
      --light-gray: #e9ecef;
      --shadow: 0 6px 18px rgba(15,23,42,0.06);
      --radius: 8px;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; font-family: "Segoe UI", Roboto, Arial, sans-serif; }
    html, body { height: 100%; background: var(--bg); color: #222; }
    .container { display: flex; height: 100vh; }

    /* SIDEBAR */
    .sidebar {
      width: 320px;
      background: var(--card);
      padding: 20px;
      box-shadow: var(--shadow);
      overflow-y: auto;
      flex-shrink: 0;
    }

    .logo { display: flex; align-items: center; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 1px solid var(--light-gray); }
    .logo i { font-size: 24px; color: var(--primary); margin-right: 10px; }
    .logo h1 { font-size: 18px; font-weight: 700; }

    .small-note { font-size: 12px; color: var(--gray); margin-bottom: 12px; }

    .pillar-list { list-style: none; margin-top: 10px; padding-left: 0; }
    .pillar-item { margin-bottom: 8px; }
    .pillar-header {
      display:flex; justify-content:space-between; align-items:center;
      padding:10px 12px; background:#f8fafc; border-radius:var(--radius); cursor:pointer; font-weight:600; font-size:14px;
    }
    .pillar-header.active { background: var(--primary); color: white; }
    .sub-pillars { list-style:none; max-height:0; overflow:hidden; transition: all .28s ease; padding-left: 10px; margin-top:6px; }
    .sub-pillars.show { max-height: 800px; }
    .sub-pillar {
      display:flex; align-items:center; justify-content:space-between; gap:8px;
      padding:8px 12px; border-left:3px solid var(--light-gray); cursor:pointer; font-size:13px; margin:4px 0; border-radius:6px;
    }
    .sub-pillar:hover { background: rgba(67,97,238,0.04); }
    .sub-pillar.active { background: rgba(67,97,238,0.08); border-left-color: var(--primary); font-weight:600; }
    .sub-pillar .status-dot { width:8px; height:8px; border-radius:50%; background: var(--light-gray); display:inline-block; }
    .sub-pillar.completed .status-dot { background: #10b981; }

    /* MAIN */
    .main-content { flex:1; padding:30px; overflow-y:auto; }
    .content-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:24px; padding-bottom:14px; border-bottom:1px solid var(--light-gray); }
    .content-header h2 { font-size:22px; }
    .content-sub { font-size:13px; color:var(--gray); }

    /* Segmented donut */
    .progress-wrapper { display:flex; gap:18px; align-items:center; }
    .donut { width:130px; height:130px; position:relative; display:grid; place-items:center; }
    .donut svg { width:100%; height:100%; display:block; transform: rotate(-90deg); }
    .donut-center { position:absolute; text-align:center; transform: rotate(90deg); display:flex; flex-direction:column; align-items:center; gap:4px; pointer-events:none; }
    .donut-center .big { font-size:34px; font-weight:800; color:#111; line-height:1; }
    .donut-center .small { font-size:12px; color:var(--gray); }
    .progress-meta { text-align:right; }
    .progress-meta .percent { font-weight:700; font-size:14px; color:#111; }
    .progress-meta .legend { font-size:12px; color:var(--gray); margin-top:6px; }

    /* arc transition */
    .arc { transition: stroke 0.35s ease, opacity 0.35s ease; stroke-linecap: round; }

    /* FORM */
    .form-container { background: var(--card); border-radius: var(--radius); box-shadow: var(--shadow); padding: 24px; margin-bottom:20px; }
    .form-header h3 { font-size:18px; color:var(--primary); margin-bottom:6px; }
    .form-header p { font-size:13px; color:var(--gray); margin-bottom:12px; }
    .form-group { margin-bottom:14px; }
    .form-group label { display:block; margin-bottom:6px; font-weight:600; color:#222; }
    input, textarea, select { width:100%; padding:10px 12px; border:1px solid var(--light-gray); border-radius:8px; font-size:14px; }
    textarea { min-height:100px; resize:vertical; }
    .file-upload { border:2px dashed var(--light-gray); padding:18px; border-radius:8px; text-align:center; cursor:pointer; }
    .form-actions { display:flex; justify-content:flex-end; gap:10px; margin-top:8px; }
    .btn { padding:8px 14px; border-radius:8px; cursor:pointer; font-weight:700; border:none; }
    .btn-primary { background:var(--primary); color:white; }
    .btn-outline { border:1px solid var(--primary); color:var(--primary); background:transparent; }

    @media (max-width: 900px) {
      .donut { width:100px; height:100px; }
      .donut-center .big { font-size:26px; }
      .sidebar { width:100%; max-height:36vh; }
      .container { flex-direction:column; }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- SIDEBAR -->
    <div class="sidebar">
      <div class="logo">
        <i class="fas fa-book"></i>
        <h1>Brand Book Creator</h1>
      </div>
      <p class="small-note">Click a pillar → choose a sub-pillar → fill the section. Saved sections update the completion graph.</p>
      <ul class="pillar-list" id="pillarList"></ul>
    </div>

    <!-- MAIN -->
    <div class="main-content">
      <div class="content-header">
        <div>
          <h2 id="sectionTitle">Select a section</h2>
          <p id="sectionSubtitle" class="content-sub">Start by choosing a pillar and sub-pillar from the left.</p>
        </div>

        <!-- Segmented donut -->
        <div class="progress-wrapper" aria-hidden="false">
          <div class="donut" id="donutContainer" title="Completion">
            <svg id="donutSvg" viewBox="0 0 100 100" role="img" aria-label="Completion progress"></svg>
            <div class="donut-center" id="donutCenter">
              <div class="big" id="donutNumber">0</div>
              <div class="small">Total</div>
            </div>
          </div>

          <div class="progress-meta">
            <div class="percent" id="percentText">0% Complete</div>
            <div class="legend" id="legendText">0 / 0 sections</div>
          </div>
        </div>
      </div>

      <div id="formRoot">
        <div class="form-container">
          <div style="text-align:center;color:var(--gray);padding:36px 10px">
            <i class="fas fa-folder-open" style="font-size:44px;color:var(--light-gray);margin-bottom:12px;display:block"></i>
            <h3 style="margin-bottom:6px">No section selected</h3>
            <p>Pick any sub-pillar from the sidebar to start editing your brand book.</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ---------- FULL BRAND_STRUCTURE (unchanged content taken from your original file) ----------
    const BRAND_STRUCTURE = [
      {
        id: "brand-overview",
        label: "Brand Overview",
        sections: [
          {
            id: "brand-history",
            label: "Brand History",
            type: "long",
            hint: "Timeline or story of how the brand evolved over time."
          },
          {
            id: "brand-purpose",
            label: "Brand Purpose",
            type: "short",
            hint: "One clear line on why the brand exists beyond profit."
          },
          {
            id: "company-snapshot",
            label: "Company Snapshot",
            type: "table",
            hint: "Current overview: size, locations, key facts."
          }
        ]
      },
      {
        id: "mission-vision",
        label: "Mission & Vision",
        sections: [
          {
            id: "vision-statement",
            label: "Vision Statement",
            type: "long",
            hint: "Future state you want to create."
          },
          {
            id: "purpose-summary",
            label: "Purpose Summary",
            type: "short"
          },
          {
            id: "strategic-objectives",
            label: "Strategic Objectives",
            type: "table",
            hint: "List 3–5 key objectives."
          },
          {
            id: "long-term-aspirations",
            label: "Long-term Aspirations",
            type: "long"
          }
        ]
      },
      {
        id: "core-values",
        label: "Core Values",
        sections: [
          {
            id: "behavioral-examples",
            label: "Behavioral Examples",
            type: "long"
          },
          {
            id: "values-in-action",
            label: "Values in Action",
            type: "long"
          },
          {
            id: "internal-vs-external",
            label: "Internal vs External Application",
            type: "table"
          }
        ]
      },
      {
        id: "brand-positioning",
        label: "Brand Positioning",
        sections: [
          { id: "brand-promise", label: "Brand Promise", type: "short" },
          {
            id: "value-proposition",
            label: "Value Proposition",
            type: "long"
          },
          { id: "usp", label: "USP", type: "long" },
          {
            id: "perception-mapping",
            label: "Perception Mapping",
            type: "long",
            hint: "Describe axes & where you/competitors sit."
          }
        ]
      },
      {
        id: "brand-architecture",
        label: "Brand Architecture",
        sections: [
          {
            id: "product-hierarchy",
            label: "Product/Service Hierarchy",
            type: "table"
          },
          {
            id: "naming-conventions",
            label: "Naming Conventions",
            type: "long"
          },
          {
            id: "brand-relationship-models",
            label: "Brand Relationship Models",
            type: "long"
          },
          {
            id: "brand-evolution",
            label: "Brand Evolution",
            type: "long"
          }
        ]
      },
      {
        id: "target-audience",
        label: "Target Audience",
        sections: [
          {
            id: "demographics",
            label: "Demographics",
            type: "cohort", // special cohort UI
            hint: "Define age, gender, income and location cohorts."
          },
          {
            id: "psychographics",
            label: "Psychographics",
            type: "long"
          },
          { id: "pain-points", label: "Pain Points", type: "long" },
          {
            id: "buyer-journey-map",
            label: "Buyer Journey Map",
            type: "long"
          }
        ]
      },
      {
        id: "competitive-landscape",
        label: "Competitive Landscape",
        sections: [
          {
            id: "market-position-map",
            label: "Market Position Map",
            type: "upload"
          },
          {
            id: "swot-analysis",
            label: "SWOT Analysis",
            type: "swot"
          },
          {
            id: "differentiation-factors",
            label: "Differentiation Factors",
            type: "long"
          },
          {
            id: "industry-benchmarks",
            label: "Industry Benchmarks",
            type: "table"
          }
        ]
      },
      {
        id: "brand-personality",
        label: "Brand Personality",
        sections: [
          {
            id: "brand-archetype",
            label: "Brand Archetype",
            type: "short"
          },
          {
            id: "voice-attributes",
            label: "Voice Attributes",
            type: "long"
          },
          {
            id: "emotional-associations",
            label: "Emotional Associations",
            type: "long"
          },
          {
            id: "personality-in-action",
            label: "Personality in Action",
            type: "long"
          }
        ]
      },
      {
        id: "tone-of-voice",
        label: "Tone of Voice",
        sections: [
          { id: "dos-donts", label: "Do’s & Don’ts", type: "table" },
          {
            id: "communication-styles",
            label: "Communication Styles",
            type: "long"
          },
          {
            id: "medium-examples",
            label: "Medium-based Examples",
            type: "long"
          },
          {
            id: "crisis-tone",
            label: "Crisis Tone Guidelines",
            type: "long"
          }
        ]
      },
      {
        id: "messaging-pillars",
        label: "Messaging Pillars",
        sections: [
          {
            id: "messaging-framework",
            label: "Messaging Framework",
            type: "table"
          },
          {
            id: "taglines-slogans",
            label: "Taglines & Slogans",
            type: "long"
          },
          {
            id: "elevator-pitch",
            label: "Elevator Pitch",
            type: "short"
          },
          {
            id: "copy-style-guide",
            label: "Copywriting Style Guide",
            type: "long"
          }
        ]
      },
      {
        id: "logo-guidelines",
        label: "Logo Guidelines",
        sections: [
          { id: "logo-variants", label: "Logo Variants", type: "upload" },
          {
            id: "clear-space-sizing",
            label: "Clear Space & Sizing",
            type: "long"
          },
          {
            id: "incorrect-usage",
            label: "Incorrect Usage",
            type: "upload"
          },
          {
            id: "logo-downloads",
            label: "Logo File Downloads",
            type: "upload"
          }
        ]
      },
      {
        id: "brand-colors",
        label: "Brand Colors",
        sections: [
          {
            id: "secondary-colors",
            label: "Secondary Colors",
            type: "color"
          },
          {
            id: "color-codes",
            label: "Color Codes (HEX, RGB, CMYK, Pantone)",
            type: "table"
          },
          {
            id: "color-usage-guidelines",
            label: "Usage Guidelines",
            type: "long"
          },
          {
            id: "accessibility-compliance",
            label: "Accessibility Compliance",
            type: "long"
          }
        ]
      },
      {
        id: "typography",
        label: "Typography",
        sections: [
          {
            id: "supporting-fonts",
            label: "Supporting Fonts",
            type: "upload"
          },
          {
            id: "font-hierarchy",
            label: "Font Hierarchy",
            type: "table"
          },
          {
            id: "web-print-rules",
            label: "Web & Print Rules",
            type: "long"
          },
          {
            id: "line-height-kerning",
            label: "Line Height & Kerning",
            type: "long"
          }
        ]
      },
      {
        id: "imagery-style",
        label: "Imagery Style",
        sections: [
          {
            id: "filters-treatments",
            label: "Filters & Treatments",
            type: "long"
          },
          {
            id: "composition",
            label: "Composition",
            type: "long"
          },
          {
            id: "subject-guidelines",
            label: "Subject Guidelines",
            type: "long"
          },
          {
            id: "image-dos-donts",
            label: "Image Do’s & Don’ts",
            type: "upload"
          }
        ]
      },
      {
        id: "iconography",
        label: "Iconography",
        sections: [
          {
            id: "grid-spacing-rules",
            label: "Grid/Spacing Rules",
            type: "long"
          },
          {
            id: "icon-color-usage",
            label: "Icon Color Usage",
            type: "color"
          },
          { id: "icon-dos-donts", label: "Do’s & Don’ts", type: "upload" },
          {
            id: "icon-download-pack",
            label: "Download Pack",
            type: "upload"
          }
        ]
      },
      {
        id: "graphic-elements",
        label: "Graphic Elements",
        sections: [
          {
            id: "decorative-shapes",
            label: "Decorative Shapes",
            type: "upload"
          },
          {
            id: "illustrations",
            label: "Illustrations",
            type: "upload"
          },
          {
            id: "backgrounds",
            label: "Backgrounds",
            type: "upload"
          },
          {
            id: "layering-rules",
            label: "Layering Rules",
            type: "long"
          }
        ]
      },
      {
        id: "motion-guidelines",
        label: "Motion Guidelines",
        sections: [
          {
            id: "motion-timing-easing",
            label: "Motion Timing/Easing",
            type: "long"
          },
          { id: "motion-use-cases", label: "Use Cases", type: "long" },
          {
            id: "inappropriate-motion",
            label: "Inappropriate Motion",
            type: "long"
          },
          {
            id: "export-specs",
            label: "Export Specs",
            type: "long"
          }
        ]
      },
      {
        id: "ui-components",
        label: "UI Components",
        sections: [
          { id: "inputs", label: "Inputs", type: "long" },
          { id: "cards", label: "Cards", type: "long" },
          { id: "navigation", label: "Navigation", type: "long" },
          {
            id: "interactive-states",
            label: "Interactive States",
            type: "upload"
          }
        ]
      },
      {
        id: "packaging-guidelines",
        label: "Packaging Guidelines",
        sections: [
          { id: "label-design", label: "Label Design", type: "upload" },
          {
            id: "barcoding-legal",
            label: "Barcoding & Legal Info",
            type: "long"
          },
          {
            id: "unboxing-experience",
            label: "Unboxing Experience",
            type: "long"
          },
          {
            id: "sustainability-standards",
            label: "Sustainability Standards",
            type: "long"
          }
        ]
      },
      {
        id: "signage-print",
        label: "Signage & Print",
        sections: [
          {
            id: "outdoor-signage",
            label: "Outdoor Signage",
            type: "upload"
          },
          {
            id: "retail-displays",
            label: "Retail Displays",
            type: "upload"
          },
          { id: "print-sizes", label: "Print Sizes", type: "table" },
          {
            id: "exhibition-booth",
            label: "Exhibition Booth Branding",
            type: "upload"
          }
        ]
      },
      {
        id: "templates-assets",
        label: "Templates & Assets",
        sections: [
          {
            id: "business-cards",
            label: "Business Cards",
            type: "upload"
          },
          {
            id: "letterhead-design",
            label: "Letterhead Design",
            type: "upload"
          },
          {
            id: "email-signatures",
            label: "Email Signatures",
            type: "long"
          },
          {
            id: "social-media-kits",
            label: "Social Media Kits",
            type: "upload"
          }
        ]
      },
      {
        id: "usage-dos-donts",
        label: "Usage Do’s & Don’ts",
        sections: [
          {
            id: "color-misuse",
            label: "Color Misuse",
            type: "upload"
          },
          {
            id: "typography-errors",
            label: "Typography Errors",
            type: "upload"
          },
          {
            id: "messaging-misalignment",
            label: "Messaging Misalignment",
            type: "long"
          },
          {
            id: "visual-mistakes",
            label: "Visual Mistakes",
            type: "upload"
          }
        ]
      },
      {
        id: "co-branding-rules",
        label: "Co-Branding Rules",
        sections: [
          { id: "co-brand-hierarchy", label: "Brand Hierarchy", type: "long" },
          {
            id: "co-brand-campaign-examples",
            label: "Campaign Examples",
            type: "upload"
          },
          {
            id: "co-brand-dos-donts",
            label: "Do’s & Don’ts",
            type: "long"
          },
          {
            id: "co-brand-terms",
            label: "Co-brand Terms & Guidelines",
            type: "long"
          }
        ]
      },
      {
        id: "legal-trademarks",
        label: "Legal & Trademarks",
        sections: [
          {
            id: "copyright-claims",
            label: "Copyright Claims",
            type: "long"
          },
          {
            id: "licensing-terms",
            label: "Licensing Terms",
            type: "long"
          },
          { id: "disclaimers", label: "Disclaimers", type: "long" },
          {
            id: "brand-abuse-reporting",
            label: "Brand Abuse Reporting",
            type: "short"
          }
        ]
      },
      {
        id: "industry-custom",
        label: "Industry Custom Modules",
        sections: [
          {
            id: "fashion-lookbooks",
            label: "Fashion: Fabric Visuals, Lookbooks",
            type: "upload"
          },
          {
            id: "food-label-regs",
            label: "Food: Label Regulations",
            type: "long"
          },
          {
            id: "finance-disclosures",
            label: "Finance: Legal Disclosures",
            type: "long"
          }
        ]
      },
      {
        id: "accessibility-standards",
        label: "Accessibility Standards",
        sections: [
          {
            id: "font-readability",
            label: "Font Readability",
            type: "long"
          },
          { id: "alt-text-rules", label: "Alt Text Rules", type: "long" },
          {
            id: "screen-reader-labels",
            label: "Screen Reader Labels",
            type: "long"
          },
          {
            id: "wcag-ada-guidelines",
            label: "WCAG/ADA Guidelines",
            type: "long"
          }
        ]
      }
    ];

    // ---------- STATE ----------
    const completionState = {}; // { sectionId: true }

    // Flatten sections into array to map to donut slices
    const flatSections = [];
    BRAND_STRUCTURE.forEach(p => p.sections.forEach(s => flatSections.push({ pillarId: p.id, pillarLabel: p.label, ...s })));
    const totalSections = flatSections.length;

    // Colors palette (cycles)
    const colors = [
      '#2DD4BF','#34D399','#60A5FA','#4C6EF5','#7C3AED','#D946EF',
      '#FB7185','#F97316','#F59E0B','#F472B6','#06B6D4','#10B981'
    ];

    // DOM refs
    const pillarListEl = document.getElementById('pillarList');
    const formRoot = document.getElementById('formRoot');
    const sectionTitleEl = document.getElementById('sectionTitle');
    const sectionSubtitleEl = document.getElementById('sectionSubtitle');
    const donutSvg = document.getElementById('donutSvg');
    const donutNumber = document.getElementById('donutNumber');
    const percentText = document.getElementById('percentText');
    const legendText = document.getElementById('legendText');

    // Visual params
    const visualSegments = totalSections; // one slice per section
    const strokeWidth = 12;              // thickness of ring
    const gapDegrees = 2.2;              // visual gap between slices (deg)
    const viewBoxSize = 100;             // SVG viewBox 0..100
    const center = viewBoxSize / 2;
    const radius = 36;                   // circle radius within viewBox
    const circumference = 2 * Math.PI * radius;

    // ---------- RENDER SIDEBAR ----------
    function renderSidebar() {
      pillarListEl.innerHTML = '';
      BRAND_STRUCTURE.forEach((pillar, pIdx) => {
        const li = document.createElement('li');
        li.className = 'pillar-item';

        const header = document.createElement('div');
        header.className = 'pillar-header' + (pIdx === 0 ? ' active' : '');
        header.dataset.pillarId = pillar.id;
        header.innerHTML = `<span>${pillar.label}</span><i class="fas fa-chevron-right"></i>`;

        const subList = document.createElement('ul');
        subList.className = 'sub-pillars' + (pIdx === 0 ? ' show' : '');
        pillar.sections.forEach((sec, sIdx) => {
          const subLi = document.createElement('li');
          subLi.className = 'sub-pillar' + (pIdx === 0 && sIdx === 0 ? ' active' : '');
          subLi.dataset.sectionId = sec.id;
          subLi.innerHTML = `
            <div style="display:flex;align-items:center;gap:8px">
              <i class="fas fa-circle-notch" style="font-size:11px;color:var(--gray)"></i>
              <span>${sec.label}</span>
            </div>
            <span class="status-dot"></span>
          `;
          subList.appendChild(subLi);
        });

        li.appendChild(header);
        li.appendChild(subList);
        pillarListEl.appendChild(li);
      });

      bindSidebarEvents();
    }

    function bindSidebarEvents() {
      document.querySelectorAll('.pillar-header').forEach((header) => {
        header.addEventListener('click', () => {
          document.querySelectorAll('.pillar-header').forEach((h) => {
            if (h !== header) {
              h.classList.remove('active');
              h.nextElementSibling.classList.remove('show');
            }
          });
          header.classList.toggle('active');
          header.nextElementSibling.classList.toggle('show');
        });
      });

      document.querySelectorAll('.sub-pillar').forEach((sub) => {
        sub.addEventListener('click', () => {
          const sectionId = sub.dataset.sectionId;
          document.querySelectorAll('.sub-pillar').forEach((s) => s.classList.remove('active'));
          sub.classList.add('active');
          const section = findSectionById(sectionId);
          renderSectionForm(section);
        });
      });
    }

    function findSectionById(id) {
      for (const pillar of BRAND_STRUCTURE) {
        for (const sec of pillar.sections) {
          if (sec.id === id) return { pillar, sec };
        }
      }
      return null;
    }

    // ---------- DONUT RENDER ----------
    function renderDonut() {
      donutSvg.innerHTML = ''; // clear previous arcs

      // compute how many segments are completed in index order of flatSections
      const completedIds = Object.keys(completionState);
      // find mapping index -> completed boolean
      const completedIndexSet = new Set(flatSections.map((s, idx) => completedIds.includes(s.id) ? idx : -1).filter(i => i >=0));
      // But we need a simple approach: mark segments as completed if their corresponding sectionId is in completionState
      // We'll loop by segment and determine color by flatSections[i].id presence in completionState.

      // compute arc lengths
      const sliceAngle = 360 / visualSegments;
      const drawAngle = sliceAngle - gapDegrees;

      const r = radius;
      const circ = circumference;
      const portion = (drawAngle / 360) * circ;
      const rest = circ - portion;

      for (let i = 0; i < visualSegments; i++) {
        const sec = flatSections[i];
        const isCompleted = sec && completionState[sec.id];

        const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
        const startAngle = i * sliceAngle + gapDegrees / 2; // rotate group to put the visible arc in its slot
        g.setAttribute('transform', `rotate(${startAngle} ${center} ${center})`);

        const circEl = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
        circEl.setAttribute('cx', center);
        circEl.setAttribute('cy', center);
        circEl.setAttribute('r', r);
        circEl.setAttribute('fill', 'none');
        circEl.setAttribute('stroke-width', strokeWidth);
        circEl.setAttribute('class', 'arc');

        // stroke-dasharray shows portion then the rest
        circEl.setAttribute('stroke-dasharray', `${portion} ${rest}`);

        // color: completed -> palette; else pending muted
        const strokeColor = isCompleted ? colors[i % colors.length] : '#e6eef3';
        circEl.setAttribute('stroke', strokeColor);

        // append
        g.appendChild(circEl);
        donutSvg.appendChild(g);
      }

      // update numbers/text
      const completedCount = Object.keys(completionState).length;
      const percent = totalSections ? Math.round((completedCount / totalSections) * 100) : 0;
      donutNumber.textContent = completedCount;
      percentText.textContent = `${percent}% Complete`;
      legendText.textContent = `${completedCount} / ${totalSections} sections`;
    }

    // ---------- FORM rendering logic (keeps original field types) ----------
    function renderSectionForm({ pillar, sec }) {
      sectionTitleEl.textContent = sec.label;
      sectionSubtitleEl.textContent = pillar.label;

      const container = document.createElement('div');
      container.className = 'form-container';

      const header = document.createElement('div');
      header.className = 'form-header';
      header.innerHTML = `
        <h3>${sec.label}</h3>
        <p>${sec.hint || 'Fill the content for this brand book section.'}</p>
      `;
      container.appendChild(header);

      const formBody = document.createElement('div');

      switch (sec.type) {
        case 'short':
          formBody.appendChild(makeShortField(sec));
          break;
        case 'upload':
          formBody.appendChild(makeUploadField());
          break;
        case 'table':
          formBody.appendChild(makeTableField());
          break;
        case 'swot':
          formBody.appendChild(makeSwotField());
          break;
        case 'color':
          formBody.appendChild(makeColorField());
          break;
        case 'cohort':
          formBody.appendChild(makeCohortField());
          break;
        case 'long':
        default:
          formBody.appendChild(makeLongField(sec));
          break;
      }

      container.appendChild(formBody);

      const actions = document.createElement('div');
      actions.className = 'form-actions';
      actions.innerHTML = `
        <button class="btn btn-outline" type="button">Reset</button>
        <button class="btn btn-primary" type="button">Save Section <i class="fas fa-check" style="margin-left:8px"></i></button>
      `;
      const [resetBtn, saveBtn] = actions.querySelectorAll('button');

      resetBtn.addEventListener('click', () => {
        container.querySelectorAll('input, textarea').forEach((el) => {
          if (el.type === 'color') return;
          if (el.type === 'radio') return;
          el.value = '';
        });
        container.querySelectorAll('.chip-toggle').forEach((c) => c.classList.remove('active'));
      });

      saveBtn.addEventListener('click', () => {
        // mark completed
        completionState[sec.id] = true;
        // update sidebar visual completed dot
        markSidebarCompleted(sec.id);
        updateCompletionUI();
      });

      container.appendChild(actions);

      formRoot.innerHTML = '';
      formRoot.appendChild(container);

      // enable chip toggle for cohort UI
      container.addEventListener('click', (e) => {
        if (e.target.classList.contains('chip-toggle')) e.target.classList.toggle('active');
      });
    }

    // ---------- FIELD BUILDERS ----------
    function makeShortField(sec) {
      const wrapper = document.createElement('div');
      wrapper.className = 'form-group';
      wrapper.innerHTML = `
        <label>${sec.label}</label>
        <input type="text" placeholder="Write a concise line here..." />
      `;
      return wrapper;
    }

    function makeLongField(sec) {
      const wrapper = document.createElement('div');
      wrapper.className = 'form-group';
      wrapper.innerHTML = `
        <label>${sec.label}</label>
        <textarea placeholder="Write detailed content for this section..."></textarea>
        <div class="hint" style="font-size:12px;color:var(--gray);margin-top:6px">Use paragraphs or bullet points as needed.</div>
      `;
      return wrapper;
    }

    function makeUploadField() {
      const wrapper = document.createElement('div');
      wrapper.className = 'form-group';
      wrapper.innerHTML = `
        <label>Upload Asset</label>
        <div class="file-upload">
          <i class="fas fa-cloud-upload-alt" style="font-size:22px;color:var(--gray);display:block;margin-bottom:8px"></i>
          <p style="color:var(--gray);font-size:13px;margin:0">Click to simulate uploading an image/file</p>
        </div>
        <div class="hint" style="font-size:12px;color:var(--gray);margin-top:8px">In a real app this would open the file picker.</div>
      `;
      wrapper.querySelector('.file-upload').addEventListener('click', (e) => {
        e.currentTarget.innerHTML = '<i class="fas fa-check-circle" style="font-size:22px;color:#10b981;display:block;margin-bottom:8px"></i><p style="color:#10b981;margin:0">File uploaded (demo)</p>';
        e.currentTarget.style.borderColor = '#a5d8ff';
        e.currentTarget.style.backgroundColor = 'rgba(67,97,238,0.04)';
      });
      return wrapper;
    }

    function makeTableField() {
      const wrapper = document.createElement('div');
      wrapper.className = 'form-group';
      wrapper.innerHTML = `
        <label>Structured List</label>
        <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:10px">
          <div style="background:#f8fafc;padding:10px;border-radius:8px"><h4 style="margin:0 0 6px 0;font-size:13px">Item 1</h4><textarea placeholder="Describe item 1"></textarea></div>
          <div style="background:#f8fafc;padding:10px;border-radius:8px"><h4 style="margin:0 0 6px 0;font-size:13px">Item 2</h4><textarea placeholder="Describe item 2"></textarea></div>
          <div style="background:#f8fafc;padding:10px;border-radius:8px"><h4 style="margin:0 0 6px 0;font-size:13px">Item 3</h4><textarea placeholder="Describe item 3"></textarea></div>
          <div style="background:#f8fafc;padding:10px;border-radius:8px"><h4 style="margin:0 0 6px 0;font-size:13px">Item 4</h4><textarea placeholder="Describe item 4"></textarea></div>
        </div>
      `;
      return wrapper;
    }

    function makeSwotField() {
      const wrapper = document.createElement('div');
      wrapper.className = 'form-group';
      wrapper.innerHTML = `
        <label>SWOT Analysis</label>
        <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:10px">
          <div style="background:#f8fafc;padding:10px;border-radius:8px"><h4 style="margin:0 0 6px 0;font-size:13px">Strengths</h4><textarea placeholder="Internal positive attributes"></textarea></div>
          <div style="background:#f8fafc;padding:10px;border-radius:8px"><h4 style="margin:0 0 6px 0;font-size:13px">Weaknesses</h4><textarea placeholder="Internal negative attributes"></textarea></div>
          <div style="background:#f8fafc;padding:10px;border-radius:8px"><h4 style="margin:0 0 6px 0;font-size:13px">Opportunities</h4><textarea placeholder="External positive factors"></textarea></div>
          <div style="background:#f8fafc;padding:10px;border-radius:8px"><h4 style="margin:0 0 6px 0;font-size:13px">Threats</h4><textarea placeholder="External negative factors"></textarea></div>
        </div>
      `;
      return wrapper;
    }

    function makeColorField() {
      const wrapper = document.createElement('div');
      wrapper.className = 'form-group';
      wrapper.innerHTML = `
        <label>Primary Color</label>
        <input type="color" value="#4361ee" />
        <div class="hint" style="font-size:12px;color:var(--gray);margin-top:8px">Pick your brand secondary or accent color.</div>
      `;
      return wrapper;
    }

    function makeCohortField() {
      const wrapper = document.createElement('div');
      wrapper.className = 'form-group';
      wrapper.innerHTML = `
        <label>Audience Details</label>

        <div style="margin-top:10px"><label style="display:block;margin-bottom:6px">Age</label>
          <div style="display:flex;flex-wrap:wrap;gap:8px">
            <button type="button" class="chip-toggle" style="padding:6px 10px;border-radius:999px;border:1px solid var(--light-gray)">18–24 Years</button>
            <button type="button" class="chip-toggle" style="padding:6px 10px;border-radius:999px;border:1px solid var(--light-gray)">25–34 Years</button>
            <button type="button" class="chip-toggle" style="padding:6px 10px;border-radius:999px;border:1px solid var(--light-gray)">35–44 Years</button>
            <button type="button" class="chip-toggle" style="padding:6px 10px;border-radius:999px;border:1px solid var(--light-gray)">45–54 Years</button>
            <button type="button" class="chip-toggle" style="padding:6px 10px;border-radius:999px;border:1px solid var(--light-gray)">55–64 Years</button>
            <button type="button" class="chip-toggle" style="padding:6px 10px;border-radius:999px;border:1px solid var(--light-gray)">65+ Years</button>
          </div>
        </div>

        <div style="margin-top:12px"><label style="display:block;margin-bottom:6px">Gender</label>
          <div style="display:flex;gap:8px">
            <button type="button" class="chip-toggle" style="padding:6px 10px;border-radius:999px;border:1px solid var(--light-gray)">Male</button>
            <button type="button" class="chip-toggle" style="padding:6px 10px;border-radius:999px;border:1px solid var(--light-gray)">Female</button>
            <button type="button" class="chip-toggle" style="padding:6px 10px;border-radius:999px;border:1px solid var(--light-gray)">Others</button>
          </div>
        </div>

        <div style="margin-top:12px"><label style="display:block;margin-bottom:6px">Household Income</label>
          <div style="display:flex;flex-wrap:wrap;gap:8px">
            <button type="button" class="chip-toggle" style="padding:6px 10px;border-radius:999px;border:1px solid var(--light-gray)">CAT-A (0–5L)</button>
            <button type="button" class="chip-toggle" style="padding:6px 10px;border-radius:999px;border:1px solid var(--light-gray)">CTA-B (5–10L)</button>
            <button type="button" class="chip-toggle" style="padding:6px 10px;border-radius:999px;border:1px solid var(--light-gray)">MIG (10–20L)</button>
            <button type="button" class="chip-toggle" style="padding:6px 10px;border-radius:999px;border:1px solid var(--light-gray)">HIG (20L+)</button>
          </div>
        </div>

        <div style="margin-top:12px">
          <hr style="border:none;border-top:1px solid var(--light-gray);margin:12px 0">
          <label style="display:block;margin-bottom:6px">Locations</label>
          <div style="display:flex;gap:12px;margin-bottom:8px">
            <label style="font-size:13px"><input type="radio" name="locMode" checked /> India</label>
            <label style="font-size:13px"><input type="radio" name="locMode" /> Enter Another Location</label>
          </div>
          <input type="text" placeholder="Enter location to include or exclude">
          <div style="font-size:12px;color:var(--gray);margin-top:6px">Add locations to define your audience for this survey.</div>
        </div>

        <div style="margin-top:12px">
          <label style="display:block;margin-bottom:6px">Interest</label>
          <input type="text" placeholder="e.g., Luxury Car">
          <div style="font-size:12px;color:var(--gray);margin-top:6px">Type an interest to segment your audience further.</div>
        </div>

        <div style="margin-top:12px">
          <label style="display:block;margin-bottom:6px">Selected Interests</label>
          <div style="min-height:40px;padding:8px;border-radius:8px;border:1px dashed var(--light-gray);display:flex;gap:8px;flex-wrap:wrap">
            <span style="padding:4px 10px;background:#f8fafc;border-radius:999px;font-size:12px">Luxury Car</span>
          </div>
        </div>
      `;
      return wrapper;
    }

    // ---------- COMPLETION UI ----------
    function updateCompletionUI() {
      // re-render donut
      renderDonut();
    }

    function markSidebarCompleted(sectionId) {
      const node = document.querySelector(`.sub-pillar[data-section-id="${sectionId}"]`);
      if (node) node.classList.add('completed');
    }

    // ---------- INIT ----------
    renderSidebar();
    updateCompletionUI();

    // open first section by default
    const firstPillar = BRAND_STRUCTURE[0];
    if (firstPillar && firstPillar.sections[0]) {
      const firstSec = firstPillar.sections[0];
      const node = document.querySelector(`.sub-pillar[data-section-id="${firstSec.id}"]`);
      if (node) node.classList.add('active');
      renderSectionForm({ pillar: firstPillar, sec: firstSec });
    }

    // Ensure clicking chip toggles visually (global capture for dynamically created chips)
    document.body.addEventListener('click', (e) => {
      if (e.target.classList && e.target.classList.contains('chip-toggle')) {
        e.target.classList.toggle('active');
        if (e.target.classList.contains('active')) {
          e.target.style.background = 'var(--primary)';
          e.target.style.color = '#fff';
          e.target.style.borderColor = 'var(--primary)';
        } else {
          e.target.style.background = '#fff';
          e.target.style.color = '#222';
          e.target.style.borderColor = 'var(--light-gray)';
        }
      }
    });
  </script>
</body>
</html>
