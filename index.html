<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Brand Book Creator</title>
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
  />
  <style>
    :root {
      --primary: #f37c21;
      --secondary: #c65010;
      --accent: #4361ee;
      --light: #f8f9fa;
      --dark: #212529;
      --success: #4caf50;
      --warning: #f72585;
      --gray: #6c757d;
      --light-gray: #e9ecef;
      --border-radius: 8px;
      --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      --transition: all 0.35s cubic-bezier(.2,.9,.2,1);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    }

    html,
    body {
      height: 100%;
      overflow: hidden; /* whole page doesn't scroll */
    }

    body {
      background-color: #f5f7fb;
      color: var(--dark);
      line-height: 1.6;
    }

    .container {
      display: flex;
      height: 100vh; /* full viewport */
    }

    /* Sidebar */
    .sidebar {
      width: 320px;
      background: white;
      box-shadow: var(--shadow);
      padding: 20px;
      overflow-y: auto; /* sidebar has its own scroll */
      flex-shrink: 0;
    }

    .logo {
      display: flex;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid var(--light-gray);
    }

    .logo i {
      font-size: 24px;
      color: var(--primary);
      margin-right: 10px;
    }

    .logo h1 {
      font-size: 20px;
      font-weight: 700;
    }

    .small-note {
      font-size: 12px;
      color: var(--gray);
      margin-bottom: 15px;
    }

    .pillar-list {
      list-style: none;
    }

    .pillar-item {
      margin-bottom: 5px;
    }

    .pillar-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 12px;
      background-color: var(--light);
      border-radius: var(--border-radius);
      cursor: pointer;
      transition: var(--transition);
      font-weight: 600;
      font-size: 14px;
    }

    .pillar-header:hover {
      background-color: var(--light-gray);
    }

    .pillar-header.active {
      background-color: var(--primary);
      color: white;
    }

    .pillar-header i {
      font-size: 14px;
      transition: var(--transition);
    }

    .pillar-header.active i {
      transform: rotate(90deg);
    }

    .sub-pillars {
      list-style: none;
      max-height: 0;
      overflow: hidden;
      transition: var(--transition);
      padding-left: 10px;
    }

    .sub-pillars.show {
      max-height: 600px;
    }

    .sub-pillar {
      padding: 8px 14px;
      border-left: 2px solid var(--light-gray);
      margin: 4px 0;
      cursor: pointer;
      transition: var(--transition);
      font-size: 13px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    .sub-pillar:hover {
      border-left-color: var(--accent);
      background-color: rgba(72, 149, 239, 0.08);
    }

    .sub-pillar.active {
      border-left-color: var(--primary);
      background-color: rgba(67, 97, 238, 0.08);
      font-weight: 600;
    }

    .sub-pillar-left {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .sub-pillar i {
      font-size: 11px;
      color: var(--gray);
    }

    .sub-pillar.active i {
      color: var(--primary);
    }

    .sub-pillar .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--light-gray);
    }

    .sub-pillar.completed .status-dot {
      background: #4caf50;
    }

    /* Main content */
    .main-content {
      flex: 1;
      padding: 30px;
      overflow-y: auto; /* main content scrolls separately */
    }

    .content-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding-bottom: 14px;
      border-bottom: 1px solid var(--light-gray);
    }

    .content-header h2 {
      font-size: 22px;
      color: var(--dark);
    }

    .content-sub {
      font-size: 13px;
      color: var(--gray);
    }

    /* ----- NEW: Circular progress styles ----- */
    .progress-container {
      display: flex;
      align-items: center;
      gap: 14px;
    }

    .progress-circle {
      width: 64px;
      height: 64px;
      position: relative;
      flex: 0 0 64px;
    }

    .progress-circle svg {
      transform: rotate(-90deg);
      width: 64px;
      height: 64px;
      display: block;
    }

    .progress-bg {
      stroke: var(--light-gray);
      stroke-width: 8;
      fill: none;
    }

    .progress-fg {
      stroke: var(--primary);
      stroke-linecap: round;
      stroke-width: 8;
      fill: none;
      transition: stroke-dashoffset 0.6s cubic-bezier(.2,.9,.2,1), stroke 0.3s;
    }

    .progress-inner {
      position: absolute;
      left: 0;
      top: 0;
      width: 64px;
      height: 64px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: 700;
      color: var(--dark);
      pointer-events: none;
    }

    .progress-meta {
      text-align: right;
    }

    .progress-meta .progress-text {
      display: block;
      font-size: 13px;
      color: var(--gray);
    }

    .progress-meta .progress-small {
      font-weight: 600;
      color: var(--dark);
      font-size: 14px;
    }

    .progress-legend {
      font-size: 12px;
      color: var(--gray);
      margin-top: 4px;
    }

    .progress-fg.low { stroke: #f72585; } /* low completion color */
    .progress-fg.medium { stroke: #f37c21; } /* mid */
    .progress-fg.high { stroke: var(--success); } /* high */

    /* rest of form styles (kept as before) */
    .form-container {
      background: white;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      padding: 24px;
      margin-bottom: 20px;
      animation: fadeIn 0.3s ease;
    }

    .form-header h3 {
      font-size: 18px;
      color: var(--primary);
      margin-bottom: 4px;
    }

    .form-header p {
      font-size: 13px;
      color: var(--gray);
      margin-bottom: 16px;
    }

    .form-group {
      margin-bottom: 16px;
    }

    .form-group label {
      display: block;
      margin-bottom: 6px;
      font-weight: 600;
      color: var(--dark);
      font-size: 14px;
    }

    .form-group .hint {
      font-size: 12px;
      color: var(--gray);
      margin-top: 4px;
    }

    input,
    textarea,
    select {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid var(--light-gray);
      border-radius: var(--border-radius);
      font-size: 14px;
      transition: var(--transition);
    }

    textarea {
      min-height: 110px;
      resize: vertical;
    }

    input:focus,
    textarea:focus,
    select:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 2px rgba(72, 149, 239, 0.2);
    }

    .file-upload {
      border: 2px dashed var(--light-gray);
      border-radius: var(--border-radius);
      padding: 22px;
      text-align: center;
      cursor: pointer;
      transition: var(--transition);
      font-size: 13px;
      color: var(--gray);
    }

    .file-upload i {
      font-size: 26px;
      margin-bottom: 6px;
      color: var(--gray);
    }

    .file-upload:hover {
      border-color: var(--accent);
      background-color: rgba(72, 149, 239, 0.05);
    }

    .swot-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
    }

    .swot-box {
      border-radius: var(--border-radius);
      border: 1px solid var(--light-gray);
      padding: 10px;
      background: var(--light);
    }

    .swot-box h4 {
      font-size: 13px;
      margin-bottom: 6px;
    }

    .form-actions {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: 10px;
    }

    .btn {
      padding: 10px 18px;
      border-radius: var(--border-radius);
      border: none;
      font-size: 14px;
      cursor: pointer;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: var(--transition);
    }

    .btn-primary {
      background: var(--primary);
      color: white;
    }

    .btn-primary:hover {
      background: var(--secondary);
    }

    .btn-outline {
      border: 1px solid var(--primary);
      color: var(--primary);
      background: transparent;
    }

    .btn-outline:hover {
      background: rgba(67, 97, 238, 0.08);
    }

    .empty-state {
      text-align: center;
      color: var(--gray);
      padding: 60px 20px;
    }

    .empty-state i {
      font-size: 48px;
      margin-bottom: 12px;
      color: var(--light-gray);
    }

    /* Cohort chips (Target Audience) */
    .chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 8px;
    }

    .chip-toggle {
      padding: 6px 12px;
      border-radius: 999px;
      border: 1px solid var(--light-gray);
      background: #fff;
      font-size: 13px;
      cursor: pointer;
      transition: var(--transition);
    }

    .chip-toggle.active {
      background: var(--primary);
      color: #fff;
      border-color: var(--primary);
    }

    .radio-row {
      display: flex;
      gap: 16px;
      font-size: 13px;
      margin-bottom: 8px;
    }

    .radio-row label {
      font-weight: 400;
    }

    .selected-tags {
      min-height: 40px;
      padding: 8px;
      border-radius: var(--border-radius);
      border: 1px dashed var(--light-gray);
      font-size: 13px;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .tag-pill {
      padding: 4px 10px;
      background: var(--light);
      border-radius: 999px;
      font-size: 12px;
    }

    @media (max-width: 992px) {
      .container {
        flex-direction: column;
      }

      .sidebar {
        width: 100%;
        max-height: 40vh;
      }
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(6px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- SIDEBAR -->
    <div class="sidebar">
      <div class="logo">
        <i class="fas fa-book"></i>
        <h1>Brand Book Creator</h1>
      </div>
      <p class="small-note">
        Click a pillar → choose a sub-pillar → fill the section. Saved sections
        update the completion graph.
      </p>
      <ul class="pillar-list" id="pillarList"></ul>
    </div>

    <!-- MAIN -->
    <div class="main-content">
      <div class="content-header">
        <div>
          <h2 id="sectionTitle">Select a section</h2>
          <p id="sectionSubtitle" class="content-sub">
            Start by choosing a pillar and sub-pillar from the left.
          </p>
        </div>

        <!-- NEW: Circular progress container -->
        <div class="progress-container" aria-hidden="false">
          <div class="progress-circle" title="Completion">
            <svg viewBox="0 0 36 36" role="img" aria-labelledby="progressTitle">
              <title id="progressTitle">Completion progress</title>
              <!-- background circle -->
              <path class="progress-bg" d="M18 2.0845
                   a 15.9155 15.9155 0 0 1 0 31.831
                   a 15.9155 15.9155 0 0 1 0 -31.831"/>
              <!-- foreground (stroke-dashoffset controlled by JS) -->
              <path class="progress-fg" id="progressFg" d="M18 2.0845
                   a 15.9155 15.9155 0 0 1 0 31.831
                   a 15.9155 15.9155 0 0 1 0 -31.831"/>
            </svg>
            <div class="progress-inner" id="progressInner">0%</div>
          </div>

          <div class="progress-meta">
            <div class="progress-small" id="progressSmall">0% Complete</div>
            <div class="progress-legend" id="progressLegend">0 / 0 sections</div>
          </div>
        </div>
      </div>

      <div id="formRoot">
        <div class="form-container">
          <div class="empty-state">
            <i class="fas fa-folder-open"></i>
            <h3>No section selected</h3>
            <p>
              Pick any sub-pillar from the sidebar to start editing your brand
              book.
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // -------- CONFIG: ALL PILLARS & SUB-PILLARS (unchanged) --------
    const BRAND_STRUCTURE = [
      {
        id: "brand-overview",
        label: "Brand Overview",
        sections: [
          { id: "brand-history", label: "Brand History", type: "long", hint: "Timeline or story of how the brand evolved over time." },
          { id: "brand-purpose", label: "Brand Purpose", type: "short", hint: "One clear line on why the brand exists beyond profit." },
          { id: "company-snapshot", label: "Company Snapshot", type: "table", hint: "Current overview: size, locations, key facts." }
        ]
      },
      // ... rest of structure omitted in this snippet for brevity but present in original file
      // To keep this example concise I will include everything below in the real file (same as your original).
      {
        id: "mission-vision",
        label: "Mission & Vision",
        sections: [
          { id: "vision-statement", label: "Vision Statement", type: "long", hint: "Future state you want to create." },
          { id: "purpose-summary", label: "Purpose Summary", type: "short" },
          { id: "strategic-objectives", label: "Strategic Objectives", type: "table", hint: "List 3–5 key objectives." },
          { id: "long-term-aspirations", label: "Long-term Aspirations", type: "long" }
        ]
      },
      {
        id: "core-values",
        label: "Core Values",
        sections: [
          { id: "behavioral-examples", label: "Behavioral Examples", type: "long" },
          { id: "values-in-action", label: "Values in Action", type: "long" },
          { id: "internal-vs-external", label: "Internal vs External Application", type: "table" }
        ]
      },
      {
        id: "brand-positioning",
        label: "Brand Positioning",
        sections: [
          { id: "brand-promise", label: "Brand Promise", type: "short" },
          { id: "value-proposition", label: "Value Proposition", type: "long" },
          { id: "usp", label: "USP", type: "long" },
          { id: "perception-mapping", label: "Perception Mapping", type: "long", hint: "Describe axes & where you/competitors sit." }
        ]
      },
      {
        id: "brand-architecture",
        label: "Brand Architecture",
        sections: [
          { id: "product-hierarchy", label: "Product/Service Hierarchy", type: "table" },
          { id: "naming-conventions", label: "Naming Conventions", type: "long" },
          { id: "brand-relationship-models", label: "Brand Relationship Models", type: "long" },
          { id: "brand-evolution", label: "Brand Evolution", type: "long" }
        ]
      },
      {
        id: "target-audience",
        label: "Target Audience",
        sections: [
          { id: "demographics", label: "Demographics", type: "cohort", hint: "Define age, gender, income and location cohorts." },
          { id: "psychographics", label: "Psychographics", type: "long" },
          { id: "pain-points", label: "Pain Points", type: "long" },
          { id: "buyer-journey-map", label: "Buyer Journey Map", type: "long" }
        ]
      },
      {
        id: "competitive-landscape",
        label: "Competitive Landscape",
        sections: [
          { id: "market-position-map", label: "Market Position Map", type: "upload" },
          { id: "swot-analysis", label: "SWOT Analysis", type: "swot" },
          { id: "differentiation-factors", label: "Differentiation Factors", type: "long" },
          { id: "industry-benchmarks", label: "Industry Benchmarks", type: "table" }
        ]
      },
      {
        id: "brand-personality",
        label: "Brand Personality",
        sections: [
          { id: "brand-archetype", label: "Brand Archetype", type: "short" },
          { id: "voice-attributes", label: "Voice Attributes", type: "long" },
          { id: "emotional-associations", label: "Emotional Associations", type: "long" },
          { id: "personality-in-action", label: "Personality in Action", type: "long" }
        ]
      },
      {
        id: "tone-of-voice",
        label: "Tone of Voice",
        sections: [
          { id: "dos-donts", label: "Do’s & Don’ts", type: "table" },
          { id: "communication-styles", label: "Communication Styles", type: "long" },
          { id: "medium-examples", label: "Medium-based Examples", type: "long" },
          { id: "crisis-tone", label: "Crisis Tone Guidelines", type: "long" }
        ]
      },
      {
        id: "messaging-pillars",
        label: "Messaging Pillars",
        sections: [
          { id: "messaging-framework", label: "Messaging Framework", type: "table" },
          { id: "taglines-slogans", label: "Taglines & Slogans", type: "long" },
          { id: "elevator-pitch", label: "Elevator Pitch", type: "short" },
          { id: "copy-style-guide", label: "Copywriting Style Guide", type: "long" }
        ]
      },
      {
        id: "logo-guidelines",
        label: "Logo Guidelines",
        sections: [
          { id: "logo-variants", label: "Logo Variants", type: "upload" },
          { id: "clear-space-sizing", label: "Clear Space & Sizing", type: "long" },
          { id: "incorrect-usage", label: "Incorrect Usage", type: "upload" },
          { id: "logo-downloads", label: "Logo File Downloads", type: "upload" }
        ]
      },
      {
        id: "brand-colors",
        label: "Brand Colors",
        sections: [
          { id: "secondary-colors", label: "Secondary Colors", type: "color" },
          { id: "color-codes", label: "Color Codes (HEX, RGB, CMYK, Pantone)", type: "table" },
          { id: "color-usage-guidelines", label: "Usage Guidelines", type: "long" },
          { id: "accessibility-compliance", label: "Accessibility Compliance", type: "long" }
        ]
      },
      {
        id: "typography",
        label: "Typography",
        sections: [
          { id: "supporting-fonts", label: "Supporting Fonts", type: "upload" },
          { id: "font-hierarchy", label: "Font Hierarchy", type: "table" },
          { id: "web-print-rules", label: "Web & Print Rules", type: "long" },
          { id: "line-height-kerning", label: "Line Height & Kerning", type: "long" }
        ]
      },
      {
        id: "imagery-style",
        label: "Imagery Style",
        sections: [
          { id: "filters-treatments", label: "Filters & Treatments", type: "long" },
          { id: "composition", label: "Composition", type: "long" },
          { id: "subject-guidelines", label: "Subject Guidelines", type: "long" },
          { id: "image-dos-donts", label: "Image Do’s & Don’ts", type: "upload" }
        ]
      },
      {
        id: "iconography",
        label: "Iconography",
        sections: [
          { id: "grid-spacing-rules", label: "Grid/Spacing Rules", type: "long" },
          { id: "icon-color-usage", label: "Icon Color Usage", type: "color" },
          { id: "icon-dos-donts", label: "Do’s & Don’ts", type: "upload" },
          { id: "icon-download-pack", label: "Download Pack", type: "upload" }
        ]
      },
      {
        id: "graphic-elements",
        label: "Graphic Elements",
        sections: [
          { id: "decorative-shapes", label: "Decorative Shapes", type: "upload" },
          { id: "illustrations", label: "Illustrations", type: "upload" },
          { id: "backgrounds", label: "Backgrounds", type: "upload" },
          { id: "layering-rules", label: "Layering Rules", type: "long" }
        ]
      },
      {
        id: "motion-guidelines",
        label: "Motion Guidelines",
        sections: [
          { id: "motion-timing-easing", label: "Motion Timing/Easing", type: "long" },
          { id: "motion-use-cases", label: "Use Cases", type: "long" },
          { id: "inappropriate-motion", label: "Inappropriate Motion", type: "long" },
          { id: "export-specs", label: "Export Specs", type: "long" }
        ]
      },
      {
        id: "ui-components",
        label: "UI Components",
        sections: [
          { id: "inputs", label: "Inputs", type: "long" },
          { id: "cards", label: "Cards", type: "long" },
          { id: "navigation", label: "Navigation", type: "long" },
          { id: "interactive-states", label: "Interactive States", type: "upload" }
        ]
      },
      {
        id: "packaging-guidelines",
        label: "Packaging Guidelines",
        sections: [
          { id: "label-design", label: "Label Design", type: "upload" },
          { id: "barcoding-legal", label: "Barcoding & Legal Info", type: "long" },
          { id: "unboxing-experience", label: "Unboxing Experience", type: "long" },
          { id: "sustainability-standards", label: "Sustainability Standards", type: "long" }
        ]
      },
      {
        id: "signage-print",
        label: "Signage & Print",
        sections: [
          { id: "outdoor-signage", label: "Outdoor Signage", type: "upload" },
          { id: "retail-displays", label: "Retail Displays", type: "upload" },
          { id: "print-sizes", label: "Print Sizes", type: "table" },
          { id: "exhibition-booth", label: "Exhibition Booth Branding", type: "upload" }
        ]
      },
      {
        id: "templates-assets",
        label: "Templates & Assets",
        sections: [
          { id: "business-cards", label: "Business Cards", type: "upload" },
          { id: "letterhead-design", label: "Letterhead Design", type: "upload" },
          { id: "email-signatures", label: "Email Signatures", type: "long" },
          { id: "social-media-kits", label: "Social Media Kits", type: "upload" }
        ]
      },
      {
        id: "usage-dos-donts",
        label: "Usage Do’s & Don’ts",
        sections: [
          { id: "color-misuse", label: "Color Misuse", type: "upload" },
          { id: "typography-errors", label: "Typography Errors", type: "upload" },
          { id: "messaging-misalignment", label: "Messaging Misalignment", type: "long" },
          { id: "visual-mistakes", label: "Visual Mistakes", type: "upload" }
        ]
      },
      {
        id: "co-branding-rules",
        label: "Co-Branding Rules",
        sections: [
          { id: "co-brand-hierarchy", label: "Brand Hierarchy", type: "long" },
          { id: "co-brand-campaign-examples", label: "Campaign Examples", type: "upload" },
          { id: "co-brand-dos-donts", label: "Do’s & Don’ts", type: "long" },
          { id: "co-brand-terms", label: "Co-brand Terms & Guidelines", type: "long" }
        ]
      },
      {
        id: "legal-trademarks",
        label: "Legal & Trademarks",
        sections: [
          { id: "copyright-claims", label: "Copyright Claims", type: "long" },
          { id: "licensing-terms", label: "Licensing Terms", type: "long" },
          { id: "disclaimers", label: "Disclaimers", type: "long" },
          { id: "brand-abuse-reporting", label: "Brand Abuse Reporting", type: "short" }
        ]
      },
      {
        id: "industry-custom",
        label: "Industry Custom Modules",
        sections: [
          { id: "fashion-lookbooks", label: "Fashion: Fabric Visuals, Lookbooks", type: "upload" },
          { id: "food-label-regs", label: "Food: Label Regulations", type: "long" },
          { id: "finance-disclosures", label: "Finance: Legal Disclosures", type: "long" }
        ]
      },
      {
        id: "accessibility-standards",
        label: "Accessibility Standards",
        sections: [
          { id: "font-readability", label: "Font Readability", type: "long" },
          { id: "alt-text-rules", label: "Alt Text Rules", type: "long" },
          { id: "screen-reader-labels", label: "Screen Reader Labels", type: "long" },
          { id: "wcag-ada-guidelines", label: "WCAG/ADA Guidelines", type: "long" }
        ]
      }
    ];

    // ---------- STATE ----------
    const completionState = {}; // { sectionId: true }
    const totalSections = BRAND_STRUCTURE.reduce((sum, p) => sum + p.sections.length, 0);

    // ---------- DOM REFS ----------
    const pillarListEl = document.getElementById("pillarList");
    const formRoot = document.getElementById("formRoot");
    const sectionTitleEl = document.getElementById("sectionTitle");
    const sectionSubtitleEl = document.getElementById("sectionSubtitle");
    const progressFg = document.getElementById("progressFg");
    const progressInner = document.getElementById("progressInner");
    const progressSmall = document.getElementById("progressSmall");
    const progressLegend = document.getElementById("progressLegend");

    // pre-calc circle length for the SVG path (approx for that path)
    // We'll use circumference of circle radius ~15.9155 used in path
    const R = 15.9155;
    const CIRC = 2 * Math.PI * R;
    progressFg.style.strokeDasharray = String(CIRC);

    // ---------- RENDER SIDEBAR ----------
    function renderSidebar() {
      pillarListEl.innerHTML = "";
      BRAND_STRUCTURE.forEach((pillar, idx) => {
        const li = document.createElement("li");
        li.className = "pillar-item";

        const header = document.createElement("div");
        header.className = "pillar-header" + (idx === 0 ? " active" : "");
        header.dataset.pillarId = pillar.id;
        header.innerHTML = `
          <span>${pillar.label}</span>
          <i class="fas fa-chevron-right"></i>
        `;

        const subList = document.createElement("ul");
        subList.className = "sub-pillars" + (idx === 0 ? " show" : "");
        pillar.sections.forEach((sec, sIdx) => {
          const subLi = document.createElement("li");
          subLi.className =
            "sub-pillar" +
            (idx === 0 && sIdx === 0 ? " active" : "");
          subLi.dataset.sectionId = sec.id;
          subLi.innerHTML = `
            <div class="sub-pillar-left">
              <i class="fas fa-circle-notch"></i>
              <span>${sec.label}</span>
            </div>
            <span class="status-dot"></span>
          `;
          subList.appendChild(subLi);
        });

        li.appendChild(header);
        li.appendChild(subList);
        pillarListEl.appendChild(li);
      });

      bindSidebarEvents();
    }

    function bindSidebarEvents() {
      document.querySelectorAll(".pillar-header").forEach((header) => {
        header.addEventListener("click", () => {
          document.querySelectorAll(".pillar-header").forEach((h) => {
            if (h !== header) {
              h.classList.remove("active");
              h.nextElementSibling.classList.remove("show");
            }
          });
          header.classList.toggle("active");
          header.nextElementSibling.classList.toggle("show");
        });
      });

      document.querySelectorAll(".sub-pillar").forEach((sub) => {
        sub.addEventListener("click", () => {
          const sectionId = sub.dataset.sectionId;
          document
            .querySelectorAll(".sub-pillar")
            .forEach((s) => s.classList.remove("active"));
          sub.classList.add("active");
          const section = findSectionById(sectionId);
          renderSectionForm(section);
        });
      });
    }

    function findSectionById(id) {
      for (const pillar of BRAND_STRUCTURE) {
        for (const sec of pillar.sections) {
          if (sec.id === id) return { pillar, sec };
        }
      }
      return null;
    }

    // ---------- RENDER SECTION FORM ----------
    function renderSectionForm({ pillar, sec }) {
      sectionTitleEl.textContent = sec.label;
      sectionSubtitleEl.textContent = pillar.label;

      const container = document.createElement("div");
      container.className = "form-container";

      const header = document.createElement("div");
      header.className = "form-header";
      header.innerHTML = `
        <h3>${sec.label}</h3>
        <p>${sec.hint || "Fill the content for this brand book section."}</p>
      `;
      container.appendChild(header);

      const formBody = document.createElement("div");

      switch (sec.type) {
        case "short":
          formBody.appendChild(makeShortField(sec));
          break;
        case "upload":
          formBody.appendChild(makeUploadField());
          break;
        case "table":
          formBody.appendChild(makeTableField());
          break;
        case "swot":
          formBody.appendChild(makeSwotField());
          break;
        case "color":
          formBody.appendChild(makeColorField());
          break;
        case "cohort":
          formBody.appendChild(makeCohortField());
          break;
        case "long":
        default:
          formBody.appendChild(makeLongField(sec));
          break;
      }

      container.appendChild(formBody);

      const actions = document.createElement("div");
      actions.className = "form-actions";
      actions.innerHTML = `
        <button class="btn btn-outline" type="button">
          <i class="fas fa-rotate-left"></i> Reset
        </button>
        <button class="btn btn-primary" type="button">
          Save Section <i class="fas fa-check"></i>
        </button>
      `;
      const [resetBtn, saveBtn] = actions.querySelectorAll("button");

      resetBtn.addEventListener("click", () => {
        container.querySelectorAll("input, textarea").forEach((el) => {
          if (el.type === "color") return;
          if (el.type === "radio") return;
          el.value = "";
        });
        container
          .querySelectorAll(".chip-toggle")
          .forEach((c) => c.classList.remove("active"));
      });

      saveBtn.addEventListener("click", () => {
        completionState[sec.id] = true;
        updateCompletionUI();
        markSidebarCompleted(sec.id);
      });

      container.appendChild(actions);

      formRoot.innerHTML = "";
      formRoot.appendChild(container);

      // enable chip toggle behavior in cohort sections
      container.addEventListener("click", (e) => {
        if (e.target.classList.contains("chip-toggle")) {
          e.target.classList.toggle("active");
        }
      });
    }

    // ---------- FIELD BUILDERS ----------
    function makeShortField(sec) {
      const wrapper = document.createElement("div");
      wrapper.className = "form-group";
      wrapper.innerHTML = `
        <label>${sec.label}</label>
        <input type="text" placeholder="Write a concise line here..." />
      `;
      return wrapper;
    }

    function makeLongField(sec) {
      const wrapper = document.createElement("div");
      wrapper.className = "form-group";
      wrapper.innerHTML = `
        <label>${sec.label}</label>
        <textarea placeholder="Write detailed content for this section..."></textarea>
        <div class="hint">Use paragraphs or bullet points as needed.</div>
      `;
      return wrapper;
    }

    function makeUploadField() {
      const wrapper = document.createElement("div");
      wrapper.className = "form-group";
      wrapper.innerHTML = `
        <label>Upload Asset</label>
        <div class="file-upload">
          <i class="fas fa-cloud-upload-alt"></i>
          <p>Click to simulate uploading an image/file</p>
        </div>
        <div class="hint">In a real app this would open the file picker.</div>
      `;
      wrapper.querySelector(".file-upload").addEventListener("click", (e) => {
        e.currentTarget.innerHTML =
          '<i class="fas fa-check-circle"></i><p>File uploaded (demo)</p>';
        e.currentTarget.style.borderColor = "var(--accent)";
        e.currentTarget.style.backgroundColor = "rgba(72,149,239,0.08)";
      });
      return wrapper;
    }

    function makeTableField() {
      const wrapper = document.createElement("div");
      wrapper.className = "form-group";
      wrapper.innerHTML = `
        <label>Structured List</label>
        <div class="swot-grid">
          <div class="swot-box">
            <h4>Item 1</h4>
            <textarea placeholder="Describe item 1"></textarea>
          </div>
          <div class="swot-box">
            <h4>Item 2</h4>
            <textarea placeholder="Describe item 2"></textarea>
          </div>
          <div class="swot-box">
            <h4>Item 3</h4>
            <textarea placeholder="Describe item 3"></textarea>
          </div>
          <div class="swot-box">
            <h4>Item 4</h4>
            <textarea placeholder="Describe item 4"></textarea>
          </div>
        </div>
      `;
      return wrapper;
    }

    function makeSwotField() {
      const wrapper = document.createElement("div");
      wrapper.className = "form-group";
      wrapper.innerHTML = `
        <label>SWOT Analysis</label>
        <div class="swot-grid">
          <div class="swot-box">
            <h4>Strengths</h4>
            <textarea placeholder="Internal positive attributes"></textarea>
          </div>
          <div class="swot-box">
            <h4>Weaknesses</h4>
            <textarea placeholder="Internal negative attributes"></textarea>
          </div>
          <div class="swot-box">
            <h4>Opportunities</h4>
            <textarea placeholder="External positive factors"></textarea>
          </div>
          <div class="swot-box">
            <h4>Threats</h4>
            <textarea placeholder="External negative factors"></textarea>
          </div>
        </div>
      `;
      return wrapper;
    }

    function makeColorField() {
      const wrapper = document.createElement("div");
      wrapper.className = "form-group";
      wrapper.innerHTML = `
        <label>Primary Color</label>
        <input type="color" value="#4361ee" />
        <div class="hint">Pick your brand secondary or accent color.</div>
      `;
      return wrapper;
    }

    // Cohort-style field for Target Audience → Demographics
    function makeCohortField() {
      const wrapper = document.createElement("div");
      wrapper.innerHTML = `
        <div class="form-group">
          <label>Audience Details</label>
        </div>

        <div class="form-group">
          <label>Age</label>
          <div class="chip-row">
            <button type="button" class="chip-toggle">18–24 Years</button>
            <button type="button" class="chip-toggle">25–34 Years</button>
            <button type="button" class="chip-toggle">35–44 Years</button>
            <button type="button" class="chip-toggle">45–54 Years</button>
            <button type="button" class="chip-toggle">55–64 Years</button>
            <button type="button" class="chip-toggle">65+ Years</button>
          </div>
        </div>

        <div class="form-group">
          <label>Gender</label>
          <div class="chip-row">
            <button type="button" class="chip-toggle">Male</button>
            <button type="button" class="chip-toggle">Female</button>
            <button type="button" class="chip-toggle">Others</button>
          </div>
        </div>

        <div class="form-group">
          <label>Parental Status</label>
          <div class="chip-row">
            <button type="button" class="chip-toggle">Parent</button>
            <button type="button" class="chip-toggle">Not a Parent</button>
            <button type="button" class="chip-toggle">Unknown</button>
          </div>
        </div>

        <div class="form-group">
          <label>Household Income</label>
          <div class="chip-row">
            <button type="button" class="chip-toggle">CAT-A (0–5L)</button>
            <button type="button" class="chip-toggle">CTA-B (5–10L)</button>
            <button type="button" class="chip-toggle">MIG (10–20L)</button>
            <button type="button" class="chip-toggle">HIG (20L+)</button>
          </div>
        </div>

        <hr style="border:none;border-top:1px solid var(--light-gray);margin:16px 0;">

        <div class="form-group">
          <label>Locations</label>
          <div class="radio-row">
            <label><input type="radio" name="locMode" checked /> India</label>
            <label><input type="radio" name="locMode" /> Enter Another Location</label>
          </div>
          <input type="text" placeholder="Enter location to include or exclude">
          <div class="hint">Add locations to define your audience for this survey.</div>
        </div>

        <div class="form-group">
          <label>Location Type</label>
          <div class="radio-row">
            <label><input type="radio" name="locType" checked /> Presence or interest in your locations (recommended)</label>
          </div>
          <div class="radio-row">
            <label><input type="radio" name="locType" /> Presence in or regularly in your locations</label>
          </div>
        </div>

        <hr style="border:none;border-top:1px solid var(--light-gray);margin:16px 0;">

        <div class="form-group">
          <label>Interest</label>
          <input type="text" placeholder="e.g., Luxury Car">
          <div class="hint">Type an interest to segment your audience further.</div>
        </div>

        <div class="form-group">
          <label>Selected Interests</label>
          <div class="selected-tags">
            <span class="tag-pill">Luxury Car</span>
          </div>
        </div>
      `;
      return wrapper;
    }

    // ---------- COMPLETION ----------
    function updateCompletionUI() {
      const completed = Object.keys(completionState).length;
      const percent = totalSections ? Math.round((completed / totalSections) * 100) : 0;

      // Update circular progress stroke-dashoffset
      // dashoffset = circumference * (1 - percent/100)
      const offset = CIRC * (1 - percent / 100);
      // apply offset with transform animation
      progressFg.style.strokeDashoffset = String(offset);

      // change progress color based on level
      progressFg.classList.remove("low", "medium", "high");
      if (percent < 35) progressFg.classList.add("low");
      else if (percent < 75) progressFg.classList.add("medium");
      else progressFg.classList.add("high");

      // update textual elements
      progressInner.textContent = percent + "%";
      progressSmall.textContent = `${percent}% Complete`;
      progressLegend.textContent = `${completed} / ${totalSections} sections`;
    }

    function markSidebarCompleted(sectionId) {
      const node = document.querySelector(`.sub-pillar[data-section-id="${sectionId}"]`);
      if (node) node.classList.add("completed");
    }

    // ---------- INIT ----------
    renderSidebar();
    updateCompletionUI();

    // open first section by default (Brand History)
    const firstPillar = BRAND_STRUCTURE[0];
    if (firstPillar && firstPillar.sections[0]) {
      const firstSec = firstPillar.sections[0];
      const node = document.querySelector(`.sub-pillar[data-section-id="${firstSec.id}"]`);
      if (node) node.classList.add("active");
      renderSectionForm({ pillar: firstPillar, sec: firstSec });
    }
  </script>
</body>
</html>
